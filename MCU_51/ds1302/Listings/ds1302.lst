C51 COMPILER V9.59.0.0   DS1302                                                            01/10/2024 21:42:40 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE DS1302
OBJECT MODULE PLACED IN .\Objects\ds1302.obj
COMPILER INVOKED BY: D:\My Program File\keil\C51\BIN\C51.EXE ..\¹«¹²ÎÄ¼þ\ds1302.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\¹«¹
                    -²ÎÄ¼þ) DEBUG OBJECTEXTEND PRINT(.\Listings\ds1302.lst) TABS(2) OBJECT(.\Objects\ds1302.obj)

line level    source

   1          #include <reg51.h>
   2          #include <intrins.h>
   3          #include "ange.h"
   4          #include "ds1302.h"
   5          uchar dstime[7]={20,7,12,20,21,47,10};
   6          void write_ds13(uchar x)
   7          {
   8   1        uchar i;
   9   1        for(i=1;i<=8;i++)
  10   1        {
  11   2          scl_ds1302=0;
  12   2          if(x&0x01)
  13   2          io_ds1302=1;
  14   2          else
  15   2          io_ds1302=0;
  16   2          scl_ds1302=1;
  17   2          x>>=1;
  18   2        }
  19   1        scl_ds1302=0;
  20   1      }
  21          uchar read_ds13()
  22          {
  23   1      
  24   1        uchar i,x;
  25   1        io_ds1302=1;
  26   1        for(i=1;i<=8;i++)
  27   1        {
  28   2          x>>=1;
  29   2          scl_ds1302=0;
  30   2          if(io_ds1302)
  31   2          x|=0x80;
  32   2          scl_ds1302=1;
  33   2        }
  34   1        scl_ds1302=0;
  35   1        return x;
  36   1      }
  37          uchar read_ds1302(uchar a)
  38          {
  39   1        uchar x;
  40   1        ce_ds1302=0;
  41   1        scl_ds1302=0;
  42   1        ce_ds1302=1;
  43   1        write_ds13(a);
  44   1        x=read_ds13();
  45   1      //  delay(10);  /////////////!!!!!!!!!!!!ÒªÃ´Io¿ÚÀ­µÍ
  46   1        io_ds1302=0;  /////////////!!!!!!!!!!!!ÒªÃ´ÑÓÊ±
  47   1        ce_ds1302=0;
  48   1        return x;
  49   1      }
  50          void write_ds1302(uchar a,uchar x)
  51          {
  52   1        ce_ds1302=0;
  53   1        scl_ds1302=0;
  54   1        ce_ds1302=1;
C51 COMPILER V9.59.0.0   DS1302                                                            01/10/2024 21:42:40 PAGE 2   

  55   1        write_ds13(a);
  56   1        write_ds13(x);
  57   1        ce_ds1302=0;
  58   1        return;
  59   1      }
  60          void write_dstime()
  61          {
  62   1        uchar a=0x8c,i,x;
  63   1        write_ds1302(0x8e,0);
  64   1        for (i=0;i<7;i++)
  65   1        {
  66   2          x=dstime[i];
  67   2          dstime[i]=x/10;
  68   2          dstime[i]<<=4;
  69   2          dstime[i]|=x%10;
  70   2          write_ds1302(a,dstime[i]);
  71   2          a-=2;
  72   2        }
  73   1        write_ds1302(0x8e,0x80);
  74   1        ce_ds1302=0;
  75   1      }
  76          void read_dstime()
  77          {
  78   1        uchar a=0x8d,x,i;
  79   1        ce_ds1302=0;
  80   1        scl_ds1302=0;
  81   1        ce_ds1302=1;
  82   1        write_ds1302(0x8e,0);
  83   1        for (i=0;i<7;i++)
  84   1        {
  85   2          x=read_ds1302(a);
  86   2          dstime[i]=x/16*10;
  87   2          dstime[i]+=x%16;
  88   2          a-=2;
  89   2        }
  90   1        write_ds1302(0x8e,0x80);
  91   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    257    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      7       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
